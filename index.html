<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday â€” Sahar ğŸ€ğŸ¸</title>
  <!-- Elegant, friendly type pairing -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Quicksand:wght@500;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    /* ===================== THEME ===================== */
    :root{
      /* Harmonized pastel palette with better contrast */
      --ink:#26252a;            /* primary text */
      --muted:#6c6a74;          /* secondary text */
      --card:#ffffff;           /* surfaces */

      /* Pastel accents (HSL for smoother tweens) */
      --pink: hsl(343 100% 90%);
      --blush:hsl(340 100% 97%);
      --lav:  hsl(265 100% 92%);
      --mint: hsl(164 100% 90%);
      --sun:  hsl(48  100% 90%);

      /* Brand accents */
      --accent: hsl(345 93% 69%);   /* strawberry */
      --accent2:hsl(257 86% 72%);   /* lilac */
      --accent3:hsl(166 69% 66%);   /* mint */

      /* Shadows */
      --shadow-lg: 0 18px 48px rgba(20,18,25,.12), 0 2px 6px rgba(20,18,25,.06);
      --shadow-sm: 0 8px 22px rgba(20,18,25,.10);

      /* Radii */
      --r-lg: 22px;
      --r-pill: 999px;
    }

    /* ===================== BASE ===================== */
    html,body{height:100%}
    *{box-sizing:border-box}

    body{
      display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0;
      color:var(--ink);
      font-family: "Plus Jakarta Sans", ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      overflow:hidden; perspective:1000px;
      background:
        radial-gradient(1200px 700px at 10% 10%, var(--sun), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, var(--mint), transparent 60%),
        radial-gradient(800px 600px at 10% 90%, var(--lav), transparent 60%),
        linear-gradient(135deg, var(--pink), var(--blush));
      animation:bgShift 18s ease-in-out infinite alternate;
    }
    @keyframes bgShift{ 0%{filter:hue-rotate(0) saturate(1)} 100%{filter:hue-rotate(10deg) saturate(1.05)} }

    /* Decorative soft texture */
    body:before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:radial-gradient(60px 60px at 30% 20%, rgba(255,255,255,.15), transparent 60%),
                 radial-gradient(60px 60px at 70% 80%, rgba(255,255,255,.12), transparent 60%);
      mix-blend-mode:soft-light;
    }

    /* ===================== BACKGROUND SHUTTLES ===================== */
    .bg-shuttle{position:fixed; font-size:34px; opacity:.08; animation:float 14s linear infinite; z-index:-1}
    @keyframes float{0%{opacity:0; transform:translateY(100vh) rotate(0deg) scale(1)}10%{opacity:.18}90%{opacity:.18}100%{opacity:0; transform:translateY(-15vh) rotate(360deg) scale(1.05)}}

    /* ===================== HEADER RIBBON ===================== */
    .ribbon{
      position:fixed; top:12px; left:50%; transform:translateX(-50%);
      background:rgba(255,255,255,.85); backdrop-filter:blur(8px);
      padding:12px 20px; border-radius:var(--r-pill); box-shadow:var(--shadow-sm);
      display:flex; align-items:center; gap:10px; z-index:6;
      border:1px solid rgba(255,255,255,.8);
    }
    .titleText{
      font-weight:800; letter-spacing:.3px;
      background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3));
      -webkit-background-clip:text; background-clip:text; color:transparent; font-size:1.14rem;
    }
    .spark{font-size:18px; animation:pulse 2.4s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

    /* ===================== MASCOT ===================== */
    .mascot{position:absolute; width:110px; height:110px; left:50%; top:58px; transform:translateX(-50%); pointer-events:none}
    .cat-head{width:78px; height:62px; background:#8f8f98; border-radius:30px; position:relative; margin:0 auto; box-shadow:0 6px 0 rgba(0,0,0,0.06) inset}
    .ear{position:absolute; top:-16px; width:0; height:0; border-left:13px solid transparent; border-right:13px solid transparent; border-bottom:26px solid #8f8f98}
    .ear.left{left:4px; transform:rotate(-18deg)} .ear.right{right:4px; transform:rotate(18deg)}
    .eye{position:absolute; top:22px; width:11px; height:11px; background:#0f0f12; border-radius:50%; animation:blink 3.2s infinite}
    .eye.left{left:18px} .eye.right{right:18px}
    .nose{position:absolute; top:34px; left:50%; transform:translateX(-50%); width:7px; height:5px; background:var(--accent); border-radius:3px}
    .whisker{position:absolute; top:32px; width:22px; height:2px; background:#666}
    .w1{left:-16px; transform:rotate(-10deg)} .w2{left:-16px; top:36px} .w3{left:-16px; top:40px; transform:rotate(10deg)}
    .w4{right:-16px; transform:rotate(10deg)} .w5{right:-16px; top:36px} .w6{right:-16px; top:40px; transform:rotate(-10deg)}
    @keyframes blink{0%,95%,100%{transform:scaleY(1)}97%{transform:scaleY(.1)}}
    .party-hat{position:absolute; left:50%; transform:translateX(-50%) rotate(-5deg); top:-24px; width:0;height:0; border-left:12px solid transparent; border-right:12px solid transparent; border-bottom:26px solid var(--accent)}
    .party-hat:after{content:""; position:absolute; left:-2px; top:-7px; width:6px; height:6px; border-radius:50%; background:#fff}
    .racket{position:absolute; right:-12px; bottom:-6px; width:36px; height:36px; border:2px solid #444; border-radius:50% 50% 44% 44% / 50% 50% 40% 40%; transform-origin:bottom left; animation:swing 2.8s ease-in-out infinite; background:
      radial-gradient(18px 18px at 50% 55%, rgba(0,0,0,.06) 20%, transparent 21%)}
    .racket:after{content:""; position:absolute; left:14px; bottom:-16px; width:6px; height:22px; background:#444; border-radius:3px}
    @keyframes swing{0%,100%{transform:rotate(18deg)}50%{transform:rotate(28deg)}}
    .sparkle{position:absolute; font-size:16px; animation:twinkle 2.4s ease-in-out infinite; opacity:.7}
    @keyframes twinkle{0%,100%{transform:scale(.85) rotate(0)}50%{transform:scale(1.15) rotate(25deg)}}

    /* ===================== DECK / CARD ===================== */
    .deck-container{position:relative; width:380px; max-width:92vw; height:520px; margin:78px 16px 16px;}

    .card{
      position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; overflow:hidden;
      cursor:pointer; backface-visibility:hidden; transition:transform .85s cubic-bezier(.16,1,.3,1), box-shadow .2s ease, filter .3s ease;
      border-radius:var(--r-lg);
      box-shadow:var(--shadow-lg);
      /* Subtle gradient surface + classy border */
      border:1.5px solid transparent;
      background:
        linear-gradient(180deg, rgba(255,255,255,.97), rgba(255,255,255,.92)) padding-box,
        conic-gradient(from 160deg, var(--accent) 0 20%, transparent 20% 40%, var(--accent2) 40% 60%, transparent 60% 80%, var(--accent3) 80% 100%) border-box;
      padding:22px 22px 18px;
      filter:saturate(1.02);
    }
    .card:hover{transform:translateX(-2px) translateY(-2px) rotate(.2deg); box-shadow:0 18px 46px rgba(20,18,25,.16)}
    .card:active{transform:translateY(0) scale(.999)}

    .corner{position:absolute; width:46px; height:46px; opacity:.2; display:grid; place-items:center; font-size:26px}
    .tl{top:8px; left:8px; transform:rotate(-20deg)}
    .tr{top:8px; right:8px; transform:rotate(20deg)}
    .bl{bottom:8px; left:8px; transform:rotate(20deg)}
    .br{bottom:8px; right:8px; transform:rotate(-20deg)}

    .title{
      font-family: "Quicksand", system-ui, sans-serif;
      font-weight:700; font-size:1.5rem; line-height:1.1; text-align:center; margin:8px 0 6px;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      letter-spacing:.2px;
    }
    .subtitle{font-size:1rem; color:var(--muted); margin:0 0 10px}

    .message{font-size:1.12rem; text-align:center; margin:8px 0 8px; color:var(--ink)}

    /* Handwritten-style comment box with notebook feel */
    .comment{
      width:94%; min-height:56%; border-radius:14px; padding:14px 14px 16px; color:#3a3940;
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86)),
        repeating-linear-gradient(
          180deg,
          transparent 0 26px,
          rgba(255,145,164,.14) 26px 27px
        );
      border:1.5px dashed rgba(255,145,164,.7);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.8);
      font-family: "Patrick Hand", "Comic Sans MS", "Patrick Hand SC", system-ui;
      font-size:20px; line-height:1.45;
    }

    /* VIDEO */
    .videoWrap{
      width:100%;
      max-width:320px;
      border-radius:16px;
      overflow:hidden;
      box-shadow: var(--shadow-sm);
      margin-top:10px;
      background:#000;
    }
    .videoWrap video{ display:block; width:100%; height:auto; outline:none; }

    /* Scatter poses */
    .card.r0{transform:translate(-80%, -60%) rotate(-15deg)}
    .card.r1{transform:translate(80%, -60%) rotate(15deg)}
    .card.r2{transform:translate(-80%, 60%) rotate(15deg)}
    .card.r3{transform:translate(80%, 60%) rotate(-15deg)}
    .card.r4{transform:translate(-100%, 0) rotate(-10deg)}
    .card.r5{transform:translate(100%, 0) rotate(10deg)}
    .card.r6{transform:translate(0, -90%) rotate(6deg)}
    .card.r7{transform:translate(0, 90%) rotate(-6deg)}
    .card.r8{transform:translate(-60%, -40%) rotate(8deg)}
    .card.r9{transform:translate(60%, 40%) rotate(-8deg)}

    /* Instructions + Buttons */
    .instructions{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,.92); padding:10px 18px; border-radius:28px; box-shadow:var(--shadow-sm); z-index:5; border:1px solid rgba(255,255,255,.9)}
    .restart{position:fixed; top:18px; right:18px; padding:10px 18px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; border:none; border-radius:22px; cursor:pointer; font-weight:800; box-shadow:0 8px 20px rgba(181,140,255,.35); z-index:5; letter-spacing:.2px}
    .restart:hover{transform:translateY(-1px)}

    /* Floating hearts & balloons */
    .float{position:absolute; font-size:24px; color:#ff9eb5; animation:up 4.2s ease-in-out infinite; opacity:0}
    @keyframes up{0%{transform:translateY(0); opacity:0} 15%{opacity:.45} 85%{opacity:.45} 100%{transform:translateY(-65px); opacity:0}}

    /* Confetti */
    .confetti{position:fixed; inset:0; pointer-events:none; z-index:2}
    .piece{position:absolute; width:8px; height:14px; background:#ffd1dc; animation:drop 3.8s linear forwards; opacity:.9; border-radius:3px}
    .piece:nth-child(3n){background:#d7fff3}
    .piece:nth-child(4n){background:#e9d7ff}
    .piece:nth-child(5n){background:#fff3c7}
    @keyframes drop{0%{transform:translateY(-10vh) rotate(0)} 100%{transform:translateY(110vh) rotate(540deg)}}

    /* Overlay (start) */
    .overlay{position:fixed; inset:0; background:rgba(255,255,255,.6); backdrop-filter:blur(6px); display:grid; place-items:center; z-index:10}
    .cta{display:flex; flex-direction:column; align-items:center; gap:14px; background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.9)); padding:24px 28px; border-radius:24px; box-shadow:var(--shadow-lg); border:1.6px solid #ffe3ea; text-align:center; animation:pop .8s ease both}
    .cta h1{margin:0; font-size:1.35rem; font-weight:800}
    .cta .big{font-size:2rem}
    .cta button{border:none; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; font-weight:900; padding:12px 20px; border-radius:var(--r-pill); cursor:pointer; box-shadow:0 12px 30px rgba(181,140,255,.3)}
    .cta button:hover{transform:translateY(-1px)}
    @keyframes pop{0%{transform:scale(.95); opacity:0}100%{transform:scale(1); opacity:1}}

    /* Music HUD */
    .hud{position:fixed; bottom:14px; right:14px; z-index:6; display:flex; gap:8px; align-items:center}
    .hud button{border:none; background:#fff; border-radius:var(--r-pill); padding:10px 12px; box-shadow:var(--shadow-sm); cursor:pointer}
    .notes{position:fixed; right:24px; bottom:64px; pointer-events:none}
    .note{position:absolute; font-size:18px; opacity:0; animation:noteUp 2.2s linear forwards}
    @keyframes noteUp{0%{transform:translateY(0) translateX(0) rotate(0); opacity:0}20%{opacity:1}100%{transform:translateY(-80px) translateX(-20px) rotate(30deg); opacity:0}}

    /* 3D tilt */
    .tilt{transform-style:preserve-3d}

    /* Stickers */
    .sticker{position:fixed; font-size:28px; opacity:.9; animation:drift 9s ease-in-out infinite alternate; pointer-events:none}
    .sticker.s1{left:6vw; top:70vh}
    .sticker.s2{right:8vw; top:22vh}
    .sticker.s3{left:12vw; top:18vh}
    @keyframes drift{0%{transform:translateY(0)}100%{transform:translateY(-12px)}}

    /* Active card glow */
    .card.is-top{box-shadow:0 22px 60px rgba(181,140,255,.28), 0 6px 18px rgba(20,18,25,.06)}

    /* Reduced motion accessibility */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important; transition:none!important}
    }

    /* Mobile tweaks */
    @media (max-width:480px){
      .deck-container{height:500px}
      .title{font-size:1.32rem}
      .comment{font-size:18px}
      .ribbon{padding:10px 16px}
      .titleText{font-size:1.02rem}
    }
  </style>
</head>
<body>
  <!-- Background shuttlecocks -->
  <div id="bg"></div>

  <!-- Soft stickers -->
  <div class="sticker s1">ğŸ’</div>
  <div class="sticker s2">â­ï¸</div>
  <div class="sticker s3">ğŸ«¶</div>

  <div class="confetti" id="confetti"></div>

  <div class="ribbon" role="banner"><span class="spark" aria-hidden="true">âœ¨</span><span class="titleText">Happy Birthday, Sahar! ğŸ‚ğŸ¸</span><span class="spark" aria-hidden="true">âœ¨</span></div>

  <!-- Deck -->
  <div class="deck-container tilt" id="deck" aria-live="polite"></div>
  <button class="restart" onclick="restartDeck()" aria-label="Reset deck">Reset Deck</button>
  <div class="instructions">Tap the top card to scatter the wishes & start the party! ğŸ‰</div>

  <div class="overlay" id="overlay" aria-modal="true" role="dialog">
    <div class="cta">
      <div class="big" aria-hidden="true">ğŸ€ğŸ¶</div>
      <h1>Tap to start the birthday party!</h1>
      <button id="startBtn" aria-label="Play music and start">Play</button>
    </div>
  </div>

  <!-- Music HUD -->
  <div class="hud" aria-live="polite">
    <button id="toggleMusic" title="Toggle music" aria-label="Toggle music">ğŸ”ˆ</button>
    <div class="notes" id="notes"></div>
  </div>

  <script>
    /* ===================== DATA ===================== */
    const wishes = [
      { title: "ğŸ¸ Smash of Smiles ğŸ€", subtitle: "From all of us", mascot:true, message: "Serving you smiles, smashing you with joy, and rallying for the best year yet!" },
      { title: "Shuttle of Joy ğŸ¸", subtitle: "Fahad", comment: "Letâ€™s play badminton again soon â€” I miss our rallies, and I definitely owe you a rematch!!" },
      { title: "Net Gain of Laughs ğŸ€", subtitle: "Fahad",  comment: "Letâ€™s change the muzzle filter to 35 â€” a little longer!!" },
      { title: "Drop Shot of Destiny ğŸ¸", subtitle: "Fahad",  comment: "Itâ€™s time we go to the masjid and find you the best match!!" },
      { title: "Spin Serve of Surprises ğŸ€", subtitle: "Fahad",  comment: "Big thanks for making me create a marriage profile!!" },
      { title: "Racket Rally of Retail ğŸ¸", subtitle: "Fahad",  comment: "Thanks for getting me hooked on SHEIN â€” my wallet is crying!!!" },
      { title: "Court-side Cheers ğŸ€", subtitle: "Fahad", comment: "Happy Birthday, Sahar! May your special day sparkle with joy and your year ahead be as beautiful as you are!" },
      { title: "Power Smash of Love ğŸ¸", subtitle: "Ayush",  comment: "Happy birthday, bacha! Thank you for being the sweetest ADD-ON to my life â¤ï¸!" },
      { title: "First Serve Memories ğŸ€", subtitle: "Ayush", comment: "One of the cutest memory of mine is from the first day on court â€” I was rattling on about things while you were just staring... I was like, â€˜God, will she please stop staring?â€™ and then laughing while looking to the other sideâ€¦ damn, she had already started judging me.!" },
      { title: "Smiley Smash Point ğŸ¸", subtitle: "Ayush",  comment: "You probably have the cutest smile BUA-JI on that bobbleheadâ€¦ so please just keep it together!" },
      { title: "Endurance Rally ğŸ€", subtitle: "Ayush",  comment: "I love how you ask me something and then never actually listenâ€¦ lol. Honestly, those 14 days of studying felt harder than my entire 2 years of Masterâ€™s. As for meditation â€” you learn it first and then teach me, okay? Chill Ayush, Iâ€™ll manage ğŸ˜…âœ¨" },
      { 
        title: "Rally of Laughter ğŸ¸ğŸ˜‚", 
        subtitle: "Ayush", 
        comment: "May the future years not turn into a marathon where Iâ€™m running and youâ€™re making me chase youâ€¦ â€˜Kya hua Sahar, aise kaun bhagta hai?â€™ ğŸƒâ€â™‚ï¸ğŸ˜‚ And one day, I might even gather enough courage to sit in your car â€” as long as you promise not to get PISSED OFF! ğŸš—ğŸ˜œ" 
        },
      { title: "Grand Slam of Wishes ğŸ¸ğŸ€", subtitle: "Ayush", comment: "Happy birthday, Sahar! ğŸ’« May you always be blessed with all the happiness in the world. Keep shining and smiling with that adorable bobblehead smile of yours. Youâ€™re truly so talented and sweet, and I know youâ€™ll do amazingly well in life." },
      

      // === FINAL VIDEO CARD ===
      { title: "Final Point: Highlight Reel ğŸ¥", subtitle: "From everyone", message: "A tiny throwback for the birthday champ! ğŸ«¶", video: { src: "sahar.mp4", poster: "poster.jpg" } }
    ];

    /* ===================== UTILS ===================== */
    function el(tag, cls){ const d=document.createElement(tag); if(cls) d.className=cls; return d; }

    /* ===================== BG SHUTTLES ===================== */
    function spawnShuttles(){
      const bg=document.getElementById('bg'); bg.innerHTML='';
      const COUNT = 12;
      for(let i=0;i<COUNT;i++){
        const s=el('div','bg-shuttle'); s.textContent='ğŸ¸';
        s.style.left=Math.random()*100+'vw';
        s.style.animationDelay=(Math.random()*10)+'s';
        s.style.fontSize=(30 + Math.random()*16)+'px';
        bg.appendChild(s);
      }
    }

    /* ===================== CONFETTI ===================== */
    function popConfetti(){
      const c=document.getElementById('confetti'); c.innerHTML='';
      const N=40; const w=window.innerWidth;
      for(let i=0;i<N;i++){
        const p=el('span','piece');
        p.style.left=Math.random()*w+'px';
        p.style.top=(-20 - Math.random()*60)+'px';
        p.style.animationDelay=(Math.random()*0.8)+'s';
        p.style.transform=`translateY(-10vh) rotate(${Math.random()*180}deg)`;
        c.appendChild(p);
      }
      setTimeout(()=> c.innerHTML='', 4000);
    }

    /* ===================== MASCOT ===================== */
    function mascotHTML(){
      return `
        <div class="mascot">
          <div class="cat-head">
            <div class="party-hat"></div>
            <div class="ear left"></div>
            <div class="ear right"></div>
            <div class="eye left"></div>
            <div class="eye right"></div>
            <div class="nose"></div>
            <div class="whisker w1"></div>
            <div class="whisker w2"></div>
            <div class="whisker w3"></div>
            <div class="whisker w4"></div>
            <div class="whisker w5"></div>
            <div class="whisker w6"></div>
            <div class="racket"></div>
          </div>
          ${sparklesAroundMascot()}
        </div>`;
    }
    function sparklesAroundMascot(){
      const spots=[[2,6],[60,0],[80,16],[10,50],[70,52]]
      return spots.map(([l,t],i)=>`<div class="sparkle" style="left:${l}px; top:${t}px; animation-delay:${i*.25}s">âœ¦</div>`).join('')
    }

    /* ===================== HEARTS ===================== */
    function floatingHearts(){
      let hearts='';
      for(let i=0;i<3;i++){
        const delay=Math.random()*3; const left=20 + Math.random()*60;
        const emoji = Math.random()>.5 ? 'ğŸ’–' : 'ğŸ’';
        hearts += `<div class="float" style="left:${left}%; animation-delay:${delay}s">${emoji}</div>`;
      }
      return hearts;
    }

    /* ===================== SPARKLE BURST ===================== */
    function sparkleBurst(x,y){
      const k=8;
      for(let i=0;i<k;i++){
        const s=el('div'); s.textContent=['âœ¨','âœ¦','â­ï¸'][i%3]; s.style.position='fixed'; s.style.left=x+'px'; s.style.top=y+'px'; s.style.opacity='0.9'; s.style.pointerEvents='none'; s.style.transition='transform 600ms ease, opacity 600ms ease'; s.style.zIndex=9;
        document.body.appendChild(s);
        const ang = (Math.PI*2)*(i/k); const dist = 24 + Math.random()*18;
        requestAnimationFrame(()=>{
          s.style.transform=`translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`; s.style.opacity='0';
        });
        setTimeout(()=> s.remove(), 650);
      }
    }

    /* ===================== DECK ===================== */
    function buildDeck(){
      const deck=document.getElementById('deck'); deck.innerHTML='';
      wishes.forEach((w,idx)=>{
        const card=el('div','card'); card.style.zIndex=wishes.length-idx;
        const t=el('div','corner tl'); t.textContent='ğŸ¸';
        const tr=el('div','corner tr'); tr.textContent='ğŸ€';
        const bl=el('div','corner bl'); bl.textContent='ğŸˆ';
        const br=el('div','corner br'); br.textContent='ğŸ‚';
        card.append(t,tr,bl,br);

        let inner='';
        if(w.mascot){ inner += mascotHTML(); }
        inner += `<h2 class="title">${w.title}</h2>`;
        if(w.subtitle){ inner += `<p class="subtitle">${w.subtitle}</p>`; }
        if(w.message){ inner += `<p class="message">${w.message}</p>`; }
        if(w.comment){ inner += `<div class="comment">${w.comment}</div>`; }

        // --- VIDEO (final card) ---
        if (w.video && w.video.src){
          inner += `
            <div class="videoWrap">
              <video ${w.video.poster ? `poster="${w.video.poster}"` : ""} playsinline muted controls preload="metadata">
                <source src="${w.video.src}" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
            </div>
          `;
        }

        inner += floatingHearts();
        card.insertAdjacentHTML('beforeend', inner);

        // Click behavior: scatter for normal cards; keep video card centered
        if (!(w.video && w.video.src)){
          card.addEventListener('click', function(ev){
            const cards=[...document.querySelectorAll('.card')];
            const top=Math.max(...cards.map(c=>parseInt(c.style.zIndex)));
            if(parseInt(this.style.zIndex)===top){
              this.classList.add('r'+(idx%10)); this.style.zIndex=1; popConfetti();
              sparkleBurst(ev.clientX, ev.clientY);
              if(!musicStarted){ startMusic(); showNotesBurst(); }
              markTopCard();
            }
          });
        } else {
          // Optional: soften/restore background music when playing the video
          const vidObserver = new MutationObserver(()=>{
            const vid = card.querySelector('video');
            if(vid){
              vid.addEventListener('play', ()=>{ if (master) master.gain.value = 0.05; });
              vid.addEventListener('pause', ()=>{ if (!isMuted && master) master.gain.value = 0.16; });
              vid.addEventListener('ended', ()=>{ if (!isMuted && master) master.gain.value = 0.16; });
              vidObserver.disconnect();
            }
          });
          vidObserver.observe(card, { childList:true, subtree:true });
        }

        deck.appendChild(card);
      });
      markTopCard();
    }

    function markTopCard(){
      const cards=[...document.querySelectorAll('.card')];
      const topZ = Math.max(...cards.map(c=>parseInt(c.style.zIndex)));
      cards.forEach(c=>c.classList.toggle('is-top', parseInt(c.style.zIndex)===topZ));
    }

    function restartDeck(){ buildDeck(); spawnShuttles(); }

    // 3D tilt
    (function(){
      const tiltEl = document.querySelector('.tilt');
      window.addEventListener('mousemove', (e)=>{
        const x=(e.clientX/window.innerWidth - .5)*8;
        const y=(e.clientY/window.innerHeight - .5)*-8;
        tiltEl.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
      });
    })();

    /* ===================== MUSIC ===================== */
    let audioCtx, master, musicStarted=false, isMuted=false;
    const melody = [
      ['G4',0.5],['G4',0.5],['A4',1],['G4',1],['C5',1],['B4',2],
      ['G4',0.5],['G4',0.5],['A4',1],['G4',1],['D5',1],['C5',2],
      ['G4',0.5],['G4',0.5],['G5',1],['E5',1],['C5',1],['B4',1],['A4',1],
      ['F5',0.5],['F5',0.5],['E5',1],['C5',1],['D5',1],['C5',2]
    ];
    const tempo = 108;

    function freqOf(note){
      const A4=440; const map={'C':-9,'C#':-8,'Db':-8,'D':-7,'D#':-6,'Eb':-6,'E':-5,'F':-4,'F#':-3,'Gb':-3,'G':-2,'G#':-1,'Ab':-1,'A':0,'A#':1,'Bb':1,'B':2};
      const m=/([A-G]#?b?)(\d)/.exec(note); if(!m) return 0; const n=m[1], o=+m[2]; const semis=map[n] + (o-4)*12; return A4*Math.pow(2, semis/12);
    }

    function startAudio(){
      if(!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); master=audioCtx.createGain(); master.gain.value=.16; master.connect(audioCtx.destination); }
    }

    function playNoteAt(freq, when, dur){
      const o=audioCtx.createOscillator(); const g=audioCtx.createGain();
      o.type='triangle'; o.frequency.value=freq; o.connect(g); g.connect(master);
      g.gain.setValueAtTime(0, when);
      g.gain.linearRampToValueAtTime(0.9, when+0.01);
      g.gain.linearRampToValueAtTime(0.0001, when+dur*0.92);
      o.start(when); o.stop(when+dur);
    }

    let loopId;
    function startMusic(){
      startAudio(); musicStarted=true; const beat = 60/tempo; let t=audioCtx.currentTime + .05;
      melody.forEach(([n,len])=>{ playNoteAt(freqOf(n), t, len*beat); t += len*beat; });
      const total = melody.reduce((s, [,l])=>s+l,0) * beat;
      loopId = setInterval(()=>{
        if(!isMuted){
          let t=audioCtx.currentTime + .05; melody.forEach(([n,len])=>{ playNoteAt(freqOf(n), t, len*beat); t += len*beat; });
          showNotesBurst();
        }
      }, (total+0.8)*1000);
    }

    function toggleMusic(){
      if(!musicStarted){ startMusic(); return }
      isMuted = !isMuted; master.gain.value = isMuted ? 0 : .16; document.getElementById('toggleMusic').textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”ˆ';
      showNotesBurst();
    }

    function showNotesBurst(){
      const holder=document.getElementById('notes');
      for(let i=0;i<5;i++){
        const n=el('div','note'); n.textContent = ['â™ª','â™©','â™«','â™¬'][Math.floor(Math.random()*4)];
        n.style.left = (Math.random()*6)+'px'; n.style.animationDelay = (Math.random()*0.2)+'s'; holder.appendChild(n);
        setTimeout(()=> n.remove(), 2200);
      }
    }

    document.getElementById('toggleMusic').addEventListener('click', toggleMusic);

    // Overlay start
    document.getElementById('startBtn').addEventListener('click', ()=>{
      document.getElementById('overlay').style.display='none';
      startMusic(); popConfetti(); showNotesBurst();
    });

    // Also start on first card tap
    window.addEventListener('pointerdown', ()=>{
      if(!musicStarted && document.getElementById('overlay').style.display!=='none'){
        document.getElementById('overlay').style.display='none';
        startMusic(); showNotesBurst();
      }
    }, { once:true });

    /* ===================== INIT ===================== */
    function init(){ spawnShuttles(); buildDeck(); }
    init();

    // Bigger balloons at intervals
    setInterval(()=> {
      const heart=el('div','float');
      heart.textContent = Math.random()>.5 ? 'ğŸˆ' : 'ğŸ’–';
      heart.style.left = (20+Math.random()*60)+'%';
      heart.style.top = '72%';
      heart.style.animationDuration = (3.6 + Math.random()*1.4)+'s';
      document.body.appendChild(heart);
      setTimeout(()=> heart.remove(), 4200);
    }, 1800);
  </script>
</body>
</html>
